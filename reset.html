<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Redefinir Senha - MaiorMargem</title>
<style>
  body {
    margin:0;
    font-family:'Segoe UI', Arial, sans-serif;
    background:#121212;
    color:#fff;
    display:flex;
    align-items:center;
    justify-content:center;
    height:100vh;
  }
  .card {
    width: 360px;
    background:#1c1c1c;
    border:1px solid #2a2a2a;
    border-radius:10px;
    padding:24px;
    text-align:center;
  }
  h1 { font-size:20px; color:#00b140; margin:0 0 12px; }
  p { margin: 8px 0; }
  input {
    width:100%;
    padding:10px;
    margin:8px 0;
    border:1px solid #2a2a2a;
    border-radius:4px;
    background:#121212;
    color:#fff;
  }
  button {
    width:100%;
    background:#00b140;
    color:#fff;
    padding:10px;
    border:none;
    border-radius:4px;
    cursor:pointer;
    margin-top:10px;
  }
  button:hover { background:#009b38; }
  .hint { font-size:12px; color:#aaa; margin-top:6px; }
</style>
</head>
<body>
<div class="card">
  <h1>Definir nova senha</h1>
  <p class="hint">Você chegou aqui pelo link enviado ao seu email.</p>
  <input id="novaSenha" type="password" placeholder="Nova senha" />
  <input id="confSenha" type="password" placeholder="Confirmar nova senha" />
  <button onclick="salvarNovaSenha()">Salvar nova senha</button>
  <p id="msg" class="hint" style="display:none; margin-top:10px;"></p>
</div>

<script src="https://unpkg.com/@supabase/supabase-js"></script>
<script>
const SUPABASE_URL = "https://maprezivxfitqyifmepq.supabase.co"; // troque pelo seu
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1hcHJleml2eGZpdHF5aWZtZXBxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM2MTc4OTcsImV4cCI6MjA2OTE5Mzg5N30.qz8iMEZY0mkh5QgeBKh8lYLITRjcAADbApJkGFwACJI";             // troque pelo seu
const HOME_URL = "https://maior-margem-site.vercel.app";      // troque pelo seu
const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

async function salvarNovaSenha() {
  const novaSenha = document.getElementById("novaSenha").value;
  const confSenha = document.getElementById("confSenha").value;
  const msg = document.getElementById("msg");

  if (!novaSenha || !confSenha) { alert("Preencha os dois campos."); return; }
  if (novaSenha !== confSenha) { alert("As senhas não conferem."); return; }
  if (novaSenha.length < 6) { alert("A senha deve ter pelo menos 6 caracteres."); return; }

  try {
    const { error } = await sb.auth.updateUser({ password: novaSenha });
    if (error) throw error;

    msg.style.display = "block";
    msg.textContent = "Senha alterada com sucesso! Redirecionando...";
    setTimeout(() => { window.location.href = HOME_URL; }, 2000);

  } catch (e) {
    alert("Erro ao redefinir senha: " + (e?.message || e));
  }
}
</script>
</body>
</html>
